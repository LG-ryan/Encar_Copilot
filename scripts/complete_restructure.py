"""
ì—”ì¹´ìƒí™œê°€ì´ë“œ.md ì™„ì „ ì¬êµ¬ì¡°í™”
Phase 2 & 3: FAQ í˜•ì‹ ì „ì²´ ì ìš© + ì²­í¬ ìµœì í™”
"""
import re

def apply_faq_format_complete(content):
    """
    ì „ì²´ ì„¹ì…˜ì— FAQ í˜•ì‹ ì ìš©
    """
    
    # ì„¹ì…˜ë³„ ì§ˆë¬¸ ë§¤í•‘
    faq_mappings = [
        # ì—…ë¬´ í™˜ê²½ ì„¸íŒ…
        (r'(### ì™€ì´íŒŒì´ ì—°ê²° ë°©ë²•\n)', r'\1\n**ì§ˆë¬¸:** ì™€ì´íŒŒì´ ë¹„ë°€ë²ˆí˜¸ê°€ ë­ì˜ˆìš”?\n\n**ë‹µë³€:**\n'),
        (r'(### ì¸í„°ë„· ì—ì´ì „íŠ¸ ì„¤ì¹˜ ë°©ë²•\n)', r'\1\n**ì§ˆë¬¸:** ë„¤íŠ¸ì›Œí¬ ì—ì´ì „íŠ¸ëŠ” ì–´ë–»ê²Œ ì„¤ì¹˜í•˜ë‚˜ìš”?\n\n**ë‹µë³€:**\n'),
        (r'(### ê·¸ë£¹ì›¨ì–´ ë¡œê·¸ì¸ ë°©ë²•\n)', r'\1\n**ì§ˆë¬¸:** ê·¸ë£¹ì›¨ì–´ëŠ” ì–´ë–»ê²Œ ë¡œê·¸ì¸í•˜ë‚˜ìš”?\n\n**ë‹µë³€:**\n'),
        (r'(### VDI ì ‘ì† ë°©ë²•\n)', r'\1\n**ì§ˆë¬¸:** VDIëŠ” ì–´ë–»ê²Œ ì ‘ì†í•˜ë‚˜ìš”?\n\n**ë‹µë³€:**\n'),
        (r'(### í”„ë¦°í„° ì„¤ì • ë°©ë²•\n)', r'\1\n**ì§ˆë¬¸:** í”„ë¦°í„°ëŠ” ì–´ë–»ê²Œ ì„¤ì •í•˜ë‚˜ìš”?\n\n**ë‹µë³€:**\n'),
        
        # ì—…ë¬´ Tool
        (r'(### ê·¸ë£¹ì›¨ì–´ ì‚¬ìš© ë°©ë²•\n)', r'\1\n**ì§ˆë¬¸:** ê·¸ë£¹ì›¨ì–´ëŠ” ì–´ë–»ê²Œ ì‚¬ìš©í•˜ë‚˜ìš”?\n\n**ë‹µë³€:**\n'),
        (r'(### VDI ì‚¬ìš© ë°©ë²•\n)', r'\1\n**ì§ˆë¬¸:** VDIëŠ” ì–´ë–»ê²Œ ì‚¬ìš©í•˜ë‚˜ìš”?\n\n**ë‹µë³€:**\n'),
        (r'(### FTC í”„ë¡œê·¸ë¨ ì‚¬ìš© ë°©ë²•\n)', r'\1\n**ì§ˆë¬¸:** FTC í”„ë¡œê·¸ë¨ì´ ë­”ê°€ìš”?\n\n**ë‹µë³€:**\n'),
        
        # ë³µë¦¬í›„ìƒ
        (r'(### ì›°ì»´ í‚¤íŠ¸ ì•ˆë‚´\n)', r'\1\n**ì§ˆë¬¸:** ì›°ì»´ í‚¤íŠ¸ì—ëŠ” ë­ê°€ ë“¤ì–´ìˆë‚˜ìš”?\n\n**ë‹µë³€:**\n'),
        (r'(### ìê¸°ê³„ë°œë¹„ ì‹ ì²­ ë°©ë²•\n)', r'\1\n**ì§ˆë¬¸:** ìê¸°ê³„ë°œë¹„ëŠ” ì–´ë–»ê²Œ ì‚¬ìš©í•˜ë‚˜ìš”?\n\n**ë‹µë³€:**\n'),
        (r'(### ê²½ì¡°ì‚¬ ì§€ì› ì•ˆë‚´\n)', r'\1\n**ì§ˆë¬¸:** ê²½ì¡°ì‚¬ ì§€ì›ì€ ì–´ë–»ê²Œ ë°›ë‚˜ìš”?\n\n**ë‹µë³€:**\n'),
        (r'(### ë¦¬ì¡°íŠ¸ ì‹ ì²­ ë° ì´ìš©\n)', r'\1\n**ì§ˆë¬¸:** ë¦¬ì¡°íŠ¸ëŠ” ì–´ë–»ê²Œ ì‹ ì²­í•˜ë‚˜ìš”?\n\n**ë‹µë³€:**\n'),
        
        # ê·¼íƒœ ë° íœ´ê°€ (ì´ë¯¸ ì ìš©ë¨, ìœ ì§€)
        (r'(### ê·¼íƒœ í™•ì¸ ë°©ë²•\n)', r'\1\n**ì§ˆë¬¸:** ê·¼íƒœëŠ” ì–´ë””ì„œ í™•ì¸í•˜ë‚˜ìš”?\n\n**ë‹µë³€:**\n'),
        (r'(### ì—°ì¥ê·¼ë¬´ ì‹ ì²­ ë°©ë²•\n)', r'\1\n**ì§ˆë¬¸:** ì—°ì¥ê·¼ë¬´ëŠ” ì–´ë–»ê²Œ ì‹ ì²­í•˜ë‚˜ìš”?\n\n**ë‹µë³€:**\n'),
        
        # ê¸‰ì—¬ ë° ê²½ë¹„
        (r'(### ê¸‰ì—¬/ê²½ë¹„ ê³„ì¢Œ ë³€ê²½ ë°©ë²•\n)', r'\1\n**ì§ˆë¬¸:** ê¸‰ì—¬ ê³„ì¢ŒëŠ” ì–´ë–»ê²Œ ë³€ê²½í•˜ë‚˜ìš”?\n\n**ë‹µë³€:**\n'),
        (r'(### ê¸‰ì—¬ëª…ì„¸ì„œ í™•ì¸ ë°©ë²•\n)', r'\1\n**ì§ˆë¬¸:** ê¸‰ì—¬ëª…ì„¸ì„œëŠ” ì–´ë””ì„œ í™•ì¸í•˜ë‚˜ìš”?\n\n**ë‹µë³€:**\n'),
        (r'(### ê²½ë¹„ ì‹ ì²­ ë°©ë²•\n)', r'\1\n**ì§ˆë¬¸:** ê²½ë¹„ëŠ” ì–´ë–»ê²Œ ì‹ ì²­í•˜ë‚˜ìš”?\n\n**ë‹µë³€:**\n'),
        
        # ì‚¬ë¬´ì‹¤ ì´ìš©
        (r'(### ëª…í•¨ ì‹ ì²­ ë°©ë²•\n)', r'\1\n**ì§ˆë¬¸:** ëª…í•¨ì€ ì–´ë–»ê²Œ ì‹ ì²­í•˜ë‚˜ìš”?\n\n**ë‹µë³€:**\n'),
        (r'(### í€µ ì„œë¹„ìŠ¤ ì‹ ì²­ ë°©ë²•\n)', r'\1\n**ì§ˆë¬¸:** í€µ ì„œë¹„ìŠ¤ëŠ” ì–´ë–»ê²Œ ì´ìš©í•˜ë‚˜ìš”?\n\n**ë‹µë³€:**\n'),
        (r'(### ì£¼ì°¨ê¶Œ ì‹ ì²­ ë°©ë²•\n)', r'\1\n**ì§ˆë¬¸:** ì£¼ì°¨ê¶Œì€ ì–´ë–»ê²Œ ì‹ ì²­í•˜ë‚˜ìš”?\n\n**ë‹µë³€:**\n'),
        (r'(### AIAíƒ€ì›Œ ì™¸ë¶€ì¸ ë°©ë¬¸ ê´€ë¦¬\n)', r'\1\n**ì§ˆë¬¸:** ì™¸ë¶€ì¸ ë°©ë¬¸ì€ ì–´ë–»ê²Œ ê´€ë¦¬í•˜ë‚˜ìš”?\n\n**ë‹µë³€:**\n'),
        
        # ì¸ì‚¬ ì„œë¹„ìŠ¤
        (r'(### ì¬ì§ì¦ëª…ì„œ ì‹ ì²­ ë°©ë²•\n)', r'\1\n**ì§ˆë¬¸:** ì¬ì§ì¦ëª…ì„œëŠ” ì–´ë–»ê²Œ ë°œê¸‰ë°›ë‚˜ìš”?\n\n**ë‹µë³€:**\n'),
        (r'(### êµìœ¡ ì‹ ì²­ ë°©ë²•\n)', r'\1\n**ì§ˆë¬¸:** êµìœ¡ì€ ì–´ë–»ê²Œ ì‹ ì²­í•˜ë‚˜ìš”?\n\n**ë‹µë³€:**\n'),
    ]
    
    for pattern, replacement in faq_mappings:
        # ì´ë¯¸ "**ì§ˆë¬¸:**"ì´ ìˆëŠ” ê²½ìš° ìŠ¤í‚µ
        if re.search(pattern + r'[^\n]*\n\*\*ì§ˆë¬¸:\*\*', content):
            continue
        content = re.sub(pattern, replacement, content)
    
    return content

def add_helpful_notes(content):
    """
    ì£¼ìš” ì„¹ì…˜ì— ì°¸ê³ ì‚¬í•­ ì¶”ê°€
    """
    
    # ì—°ì°¨/íœ´ê°€ ì„¹ì…˜ì— ì°¸ê³ ì‚¬í•­ ì¶”ê°€
    if 'â€» ì—°ì°¨ì™€ ë³´ìƒ(ëŒ€ì²´)íœ´ê°€ ì¤‘ ì—°ì°¨ ìš°ì„  ì†Œì§„ ê¶Œì¥' in content:
        content = content.replace(
            'ì¡°ì§í–‰ì‚¬ íŠ¹ë³„íœ´ê°€, ê²½ì¡°íœ´ê°€ ë“±ì€ ì‹ ì²­ì¼ìˆ˜ê°€ 0ì¼ë¡œ ë‚˜ì˜µë‹ˆë‹¤!',
            'ì¡°ì§í–‰ì‚¬ íŠ¹ë³„íœ´ê°€, ê²½ì¡°íœ´ê°€ ë“±ì€ ì‹ ì²­ì¼ìˆ˜ê°€ 0ì¼ë¡œ ë‚˜ì˜µë‹ˆë‹¤!\n\n**ì°¸ê³ ì‚¬í•­:**\nâ€¢ ë°˜ì°¨ëŠ” ì—°ì°¨ 0.5ê°œ ì°¨ê°\nâ€¢ í•˜ê³„íœ´ê°€ëŠ” ì—°ì°¨ ì°¨ê° ì—†ìŒ (6/1~10/31)\nâ€¢ ê²°ì¬ë¼ì¸: íŒ€ì›â†’íŒ€ì¥, íŒ€ì¥â†’ì°¨ìƒìœ„ ì§ì±…ì'
        )
    
    return content

def optimize_chunk_size(content):
    """
    ì²­í¬ í¬ê¸° ìµœì í™” - ë„ˆë¬´ ê¸´ ì„¹ì…˜ ë¶„ë¦¬ í‘œì‹œ
    """
    
    lines = content.split('\n')
    result = []
    current_h3 = None
    current_h3_line_count = 0
    
    for line in lines:
        if line.startswith('### '):
            if current_h3 and current_h3_line_count > 150:
                # ë„ˆë¬´ ê¸´ ì„¹ì…˜ ê²½ê³  (ê²€í†  í•„ìš”)
                print(f"   âš ï¸  ê¸´ ì„¹ì…˜ ë°œê²¬: {current_h3} ({current_h3_line_count}ì¤„)")
            current_h3 = line
            current_h3_line_count = 0
        else:
            current_h3_line_count += 1
        
        result.append(line)
    
    return '\n'.join(result)

def main():
    print("=" * 60)
    print("ğŸ“„ ì—”ì¹´ìƒí™œê°€ì´ë“œ.md ì™„ì „ ì¬êµ¬ì¡°í™” (Phase 2 & 3)")
    print("=" * 60)
    
    input_file = 'docs/ì—”ì¹´ìƒí™œê°€ì´ë“œ.md'
    backup_file = 'archives/ì—”ì¹´ìƒí™œê°€ì´ë“œ_backup_final.md'
    
    # ì›ë³¸ ì½ê¸°
    print(f"\n1ï¸âƒ£  ì›ë³¸ íŒŒì¼ ì½ê¸°: {input_file}")
    with open(input_file, 'r', encoding='utf-8') as f:
        content = f.read()
    
    # í˜„ì¬ FAQ í˜•ì‹ ê°œìˆ˜
    current_faq_count = content.count('**ì§ˆë¬¸:**')
    print(f"   í˜„ì¬ FAQ í˜•ì‹: {current_faq_count}ê°œ")
    
    # ë°±ì—…
    print(f"\n2ï¸âƒ£  ìµœì¢… ë°±ì—… ìƒì„±: {backup_file}")
    with open(backup_file, 'w', encoding='utf-8') as f:
        f.write(content)
    
    # Phase 2: FAQ í˜•ì‹ ì „ì²´ ì ìš©
    print(f"\n3ï¸âƒ£  Phase 2: ì „ì²´ ì„¹ì…˜ì— FAQ í˜•ì‹ ì ìš©...")
    content = apply_faq_format_complete(content)
    
    # ì°¸ê³ ì‚¬í•­ ì¶”ê°€
    print(f"\n4ï¸âƒ£  ì£¼ìš” ì„¹ì…˜ì— ì°¸ê³ ì‚¬í•­ ì¶”ê°€...")
    content = add_helpful_notes(content)
    
    # Phase 3: ì²­í¬ í¬ê¸° ë¶„ì„
    print(f"\n5ï¸âƒ£  Phase 3: ì²­í¬ í¬ê¸° ìµœì í™” ë¶„ì„...")
    content = optimize_chunk_size(content)
    
    final_faq_count = content.count('**ì§ˆë¬¸:**')
    print(f"\n   FAQ í˜•ì‹: {current_faq_count}ê°œ â†’ {final_faq_count}ê°œ (+{final_faq_count - current_faq_count})")
    
    # ì €ì¥
    print(f"\n6ï¸âƒ£  ì €ì¥: {input_file}")
    with open(input_file, 'w', encoding='utf-8') as f:
        f.write(content)
    
    print("\n" + "=" * 60)
    print("âœ… ì™„ì „ ì¬êµ¬ì¡°í™” ì™„ë£Œ!")
    print("=" * 60)
    print(f"\nğŸ“Š Phase 2 & 3 ì™„ë£Œ:")
    print(f"   - ì „ì²´ ì„¹ì…˜ì— FAQ í˜•ì‹ ì ìš© ({final_faq_count}ê°œ)")
    print(f"   - ì°¸ê³ ì‚¬í•­ ì¶”ê°€")
    print(f"   - ì²­í¬ í¬ê¸° ë¶„ì„ ì™„ë£Œ")
    print(f"\nâš ï¸  ì‹œë§¨í‹± ì¸ë±ìŠ¤ ì¬ìƒì„± í•„ìš”!")
    print(f"   â†’ ì„œë²„ ì¬ì‹œì‘ ì‹œ ìë™ ì¬ìƒì„±ë©ë‹ˆë‹¤!")

if __name__ == "__main__":
    main()

